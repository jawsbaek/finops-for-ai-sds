<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>9</storyId>
    <title>Epic 1 통합 테스트 및 검증</title>
    <status>drafted</status>
    <generatedAt>2025-11-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-9-epic-1-통합-테스트-및-검증.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>품질 보증 엔지니어</asA>
    <iWant>모든 Epic 1 기능이 통합되어 정상 작동하는지 확인하고</iWant>
    <soThat>사용자에게 안정적인 OpenAI 비용 관리 시스템을 제공할 수 있다</soThat>
    <tasks>
- Task 1: E2E 시나리오 테스트 구현 및 실행 (AC: #1)
  - Playwright E2E 테스트 작성 (회원가입 → API 키 생성 → 비용 수집 → 알림 → 비활성화)
  - 테스트 데이터 준비 (Mock OpenAI API 응답)
  - E2E 테스트 실행 및 모든 시나리오 통과 확인
  - CI/CD 파이프라인에 E2E 테스트 통합

- Task 2: 시스템 가동률 모니터링 설정 (AC: #2)
  - Vercel Analytics uptime 추적 설정
  - Sentry error tracking 설정 및 알림 구성
  - 7일간 가동률 측정 및 99.5% 이상 확인
  - 다운타임 로그 확인 (최대 3.6시간 이내)

- Task 3: 파일럿 사용자 테스트 수행 (AC: #3)
  - 내부 팀 1개 선정 및 온보딩
  - 파일럿 테스트 체크리스트 제공 (회원가입, 팀 생성, API 키 등록, 비용 확인, 알림 설정)
  - 1주일간 실제 사용 및 피드백 수집
  - 피드백 문서화 (긍정적 요소, 개선 필요 사항, 버그)

- Task 4: 보안 요구사항 검증 (AC: #4)
  - TLS 1.3 연결 확인 (SSL Labs 테스트)
  - AES-256 암호화 검증 (API 키, 클라우드 credentials)
  - AWS KMS envelope encryption 동작 확인
  - bcrypt password hashing 검증 (10 rounds)
  - NextAuth JWT session security 확인

- Task 5: Epic 1 검증 기준 달성 확인 (AC: #5)
  - 비용 폭주 알림 시나리오 시뮬레이션 (임계값 초과 트리거)
  - 알림 발송 및 API 키 비활성화 성공 확인
  - 실제 손실 방지 사례 1건 이상 기록 (파일럿 또는 시뮬레이션)
  - 검증 리포트 작성 (Epic 1 목표 달성 증빙)

- Task 6: 단위 및 통합 테스트 커버리지 확인
  - Vitest 단위 테스트 실행 (모든 서비스, Novel Patterns)
  - tRPC 통합 테스트 실행 (모든 프로시저)
  - 테스트 커버리지 80% 이상 확인
  - 실패한 테스트 수정 및 재실행

- Task 7: 성능 요구사항 검증 (NFR001, NFR002)
  - Lighthouse CI 성능 테스트 (LCP &lt;2.5초, FID &lt;100ms, CLS &lt;0.1)
  - 대시보드 로딩 시간 측정 (P95 &lt;3초)
  - 알림 지연 시간 측정 (임계값 초과 → 알림 발송 &lt;5분)
  - Vercel Analytics로 실제 사용자 성능 모니터링
    </tasks>
  </story>

  <acceptanceCriteria>
1. 엔드투엔드 시나리오 테스트가 성공해야 한다 (회원가입 → API 키 생성 → 비용 수집 → 알림 → 비활성화)
2. 시스템 가동률이 99.5% 이상이어야 한다 (NFR003, 최근 7일 기준)
3. 실제 사용자 1개 팀이 파일럿 테스트를 완료하고 피드백을 제공해야 한다
4. 모든 보안 요구사항이 충족되어야 한다 (TLS 1.3, AES-256 암호화, NFR004/NFR005)
5. 검증 기준 달성: 비용 폭주 알림으로 실제 손실 방지 사례 1건 이상 기록
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>finops-for-ai Product Requirements Document</title>
        <section>Phase 1A: 핵심 가설 검증 (Week 1-4)</section>
        <snippet>가설: "비용-가치 연결이 실제 의사결정을 개선하는가?" - Epic 1의 핵심 검증 목표. 비용-가치 통합 추적, 실시간 비용 폭주 방지, 행동 유도 리포트를 통해 즉각적인 가치 제공.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>finops-for-ai Product Requirements Document</title>
        <section>User Journeys - Primary Journey: 비용 급증 감지 및 즉시 대응</section>
        <snippet>사용자(FinOps 관리자)가 Slack 알림으로 비용 임계값 초과를 인지하고, 대시보드에서 상황 파악 후, API 키를 즉시 비활성화하여 추가 손실 방지. 17.5분 만에 문제 발견→차단→복구 완료.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>finops-for-ai Product Requirements Document</title>
        <section>Non-Functional Requirements</section>
        <snippet>NFR001: 대시보드 로딩 &lt;3초 (P95), NFR002: 알림 지연 &lt;5분, NFR003: 가동률 99.5% 이상, NFR004: API 자격증명 AES-256 암호화, NFR005: TLS 1.3 이상</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: 프로젝트 기반 및 OpenAI 비용 관리 시스템</title>
        <section>Story 1.9: Epic 1 통합 테스트 및 검증</section>
        <snippet>AC 1.9.1: 엔드투엔드 시나리오 테스트 성공, AC 1.9.2: 시스템 가동률 99.5% 이상, AC 1.9.3: 실제 사용자 1개 팀 파일럿 완료, AC 1.9.4: 모든 보안 요구사항 충족, AC 1.9.5: 비용 폭주 알림으로 실제 손실 방지 사례 1건 이상</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification</title>
        <section>Test Strategy Summary</section>
        <snippet>E2E Tests (Playwright): 3가지 핵심 사용자 여정. Unit Tests (Vitest): 80% 커버리지. Integration Tests (Vitest + MSW): tRPC 프로시저. Performance Tests: Lighthouse CI. Accessibility Tests: jest-axe (WCAG 2.1 AA).</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification</title>
        <section>Test Frameworks</section>
        <snippet>Vitest 설정: environment: jsdom, setupFiles, coverage provider v8 with 80% threshold. Playwright 설정: testDir __tests__/e2e, projects for chromium/webkit/mobile.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture - finops-for-ai</title>
        <section>Security Architecture</section>
        <snippet>NextAuth v5 JWT (httpOnly cookie, 30일). AWS KMS Envelope Encryption (AES-256-GCM). bcrypt password hashing (10 rounds). TLS 1.3 (Vercel 자동).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Testing (E2E)</section>
        <snippet>Playwright for E2E tests across all browsers. Vitest for unit/integration with MSW mocking. 80% coverage target. Lighthouse CI for performance.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic 1: 프로젝트 기반 및 OpenAI 비용 관리 시스템</title>
        <section>검증 기준</section>
        <snippet>최소 1개 팀이 실제 비용 절감 행동 수행. 비용 폭주 알림으로 실제 손실 방지 사례 1건 이상.</snippet>
      </doc>
      <doc>
        <path>docs/stories/1-8-긴급-조치용-기본-웹-대시보드.md</path>
        <title>Story 1.8: 긴급 조치용 기본 웹 대시보드</title>
        <section>Senior Developer Review - Story 1.8</section>
        <snippet>Advisory: E2E 테스트 누락 (Story 1.9에서 구현 필요). Lighthouse CI 미설정. Vercel Analytics, Sentry monitoring 설정 누락. 테스트 커버리지 미측정.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>vitest.config.ts</path>
        <kind>config</kind>
        <symbol>defineConfig</symbol>
        <lines>1-28</lines>
        <reason>Vitest 설정 (environment: happy-dom, coverage: v8 provider). Story 1.9에서 커버리지 80% 목표 달성 확인 필요.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/openai/cost-collector.ts</path>
        <kind>service</kind>
        <symbol>OpenAI Cost Collector</symbol>
        <lines>all</lines>
        <reason>일일 비용 수집 로직 (Story 1.2). E2E 테스트에서 Mock OpenAI API 응답 필요.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/encryption/kms-envelope.ts</path>
        <kind>service</kind>
        <symbol>KMS Envelope Encryption</symbol>
        <lines>all</lines>
        <reason>AWS KMS 기반 AES-256 암호화 (NFR004). AC #4 보안 검증 대상.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/encryption/api-key-manager.ts</path>
        <kind>service</kind>
        <symbol>API Key Manager</symbol>
        <lines>all</lines>
        <reason>프로젝트별 API 키 관리 (Novel Pattern 2). E2E 테스트에서 API 키 등록 및 비활성화 시나리오.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/monitoring/threshold-monitor.ts</path>
        <kind>service</kind>
        <symbol>Threshold Monitor</symbol>
        <lines>all</lines>
        <reason>비용 임계값 모니터링 (Story 1.4). AC #5 비용 폭주 알림 시뮬레이션 대상.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/reporting/efficiency.ts</path>
        <kind>service</kind>
        <symbol>Efficiency Calculator</symbol>
        <lines>all</lines>
        <reason>비용-가치 효율성 계산 (Novel Pattern 1). 단위 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/reporting/report-generator.ts</path>
        <kind>service</kind>
        <symbol>Report Generator</symbol>
        <lines>all</lines>
        <reason>주간 리포트 생성 (Story 1.6). E2E 테스트 시나리오 2 (주간 리포트 확인).</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/email/resend-client.ts</path>
        <kind>service</kind>
        <symbol>Resend Client</symbol>
        <lines>all</lines>
        <reason>이메일 알림 발송 (Story 1.4, 1.6). 기존 단위 테스트 존재: src/lib/services/email/__tests__/resend-client.test.ts</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/slack/webhook.ts</path>
        <kind>service</kind>
        <symbol>Slack Webhook</symbol>
        <lines>all</lines>
        <reason>Slack 알림 발송 (Story 1.4). 기존 단위 테스트 존재: src/lib/services/slack/__tests__/webhook.test.ts</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/audit/audit-logger.ts</path>
        <kind>service</kind>
        <symbol>Audit Logger</symbol>
        <lines>all</lines>
        <reason>API 키 비활성화 audit log (Story 1.5). E2E 테스트에서 로그 기록 확인.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/auth.ts</path>
        <kind>router</kind>
        <symbol>authRouter</symbol>
        <lines>all</lines>
        <reason>사용자 인증 (Story 1.1). E2E 테스트 시작점 (회원가입, 로그인). tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/project.ts</path>
        <kind>router</kind>
        <symbol>projectRouter</symbol>
        <lines>all</lines>
        <reason>프로젝트 관리 및 성과 메트릭 (Story 1.3). tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/team.ts</path>
        <kind>router</kind>
        <symbol>teamRouter</symbol>
        <lines>all</lines>
        <reason>팀 관리 및 API 키 생성 (Story 1.7). E2E 테스트: 팀 생성, API 키 등록. tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/cost.ts</path>
        <kind>router</kind>
        <symbol>costRouter</symbol>
        <lines>all</lines>
        <reason>비용 데이터 조회 및 API 키 비활성화 (Story 1.5, 1.8). tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/alert.ts</path>
        <kind>router</kind>
        <symbol>alertRouter</symbol>
        <lines>all</lines>
        <reason>비용 임계값 설정 (Story 1.4). E2E 테스트: 임계값 설정. tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/server/api/routers/report.ts</path>
        <kind>router</kind>
        <symbol>reportRouter</symbol>
        <lines>all</lines>
        <reason>리포트 조회 (Story 1.6). tRPC 통합 테스트 필요.</reason>
      </artifact>
      <artifact>
        <path>src/app/api/cron/daily-batch/route.ts</path>
        <kind>cron-endpoint</kind>
        <symbol>GET /api/cron/daily-batch</symbol>
        <lines>all</lines>
        <reason>일일 비용 수집 Cron (Story 1.2). E2E 테스트에서 수동 트리거. CRON_SECRET 검증 필요.</reason>
      </artifact>
      <artifact>
        <path>src/app/api/cron/poll-threshold/route.ts</path>
        <kind>cron-endpoint</kind>
        <symbol>GET /api/cron/poll-threshold</symbol>
        <lines>all</lines>
        <reason>임계값 폴링 Cron (Story 1.4). AC #5 비용 폭주 시뮬레이션에서 트리거. NFR002 검증 (&lt;5분).</reason>
      </artifact>
      <artifact>
        <path>src/app/api/cron/weekly-report/route.ts</path>
        <kind>cron-endpoint</kind>
        <symbol>GET /api/cron/weekly-report</symbol>
        <lines>all</lines>
        <reason>주간 리포트 Cron (Story 1.6). E2E 테스트 시나리오 2.</reason>
      </artifact>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>schema</kind>
        <symbol>Prisma Schema</symbol>
        <lines>all</lines>
        <reason>데이터베이스 스키마 전체. E2E 테스트 데이터 준비 및 초기화 필요. 모든 모델 확인 (User, Team, Project, ApiKey, CostData, CostAlert, ProjectMetrics, CronLog).</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/openai/cost-collector.test.ts</path>
        <kind>test</kind>
        <symbol>Cost Collector Unit Test</symbol>
        <lines>all</lines>
        <reason>기존 단위 테스트. AC #6 테스트 커버리지 확인 시 참고.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/email/__tests__/resend-client.test.ts</path>
        <kind>test</kind>
        <symbol>Resend Client Unit Test</symbol>
        <lines>all</lines>
        <reason>기존 단위 테스트. AC #6 테스트 커버리지 확인 시 참고.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/monitoring/__tests__/threshold-monitor.test.ts</path>
        <kind>test</kind>
        <symbol>Threshold Monitor Unit Test</symbol>
        <lines>all</lines>
        <reason>기존 단위 테스트. AC #6 테스트 커버리지 확인 시 참고.</reason>
      </artifact>
      <artifact>
        <path>src/lib/services/slack/__tests__/webhook.test.ts</path>
        <kind>test</kind>
        <symbol>Slack Webhook Unit Test</symbol>
        <lines>all</lines>
        <reason>기존 단위 테스트. AC #6 테스트 커버리지 확인 시 참고.</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <core>
          <dep name="next" version="^15.2.3" />
          <dep name="react" version="^19.0.0" />
          <dep name="react-dom" version="^19.0.0" />
          <dep name="typescript" version="^5.8.2" />
        </core>
        <testing>
          <dep name="vitest" version="^4.0.6" />
          <dep name="@vitest/ui" version="^4.0.6" />
          <dep name="happy-dom" version="^20.0.10" />
          <note>Playwright not installed yet. Story 1.9 Task 1 needs to add: @playwright/test, playwright.config.ts</note>
        </testing>
        <trpc>
          <dep name="@trpc/server" version="^11.0.0" />
          <dep name="@trpc/client" version="^11.0.0" />
          <dep name="@trpc/react-query" version="^11.0.0" />
        </trpc>
        <database>
          <dep name="@prisma/client" version="^6.5.0" />
          <dep name="prisma" version="^6.5.0" />
        </database>
        <auth>
          <dep name="next-auth" version="5.0.0-beta.25" />
          <dep name="@auth/prisma-adapter" version="^2.7.2" />
          <dep name="bcrypt" version="^6.0.0" />
          <dep name="@types/bcrypt" version="^6.0.0" />
        </auth>
        <encryption>
          <dep name="@aws-sdk/client-kms" version="^3.922.0" />
        </encryption>
        <email>
          <dep name="resend" version="^6.4.0" />
          <dep name="react-email" version="^4.3.2" />
          <dep name="@react-email/components" version="^0.5.7" />
        </email>
        <ui>
          <dep name="@radix-ui/react-*" version="various" note="Multiple Radix UI components" />
          <dep name="lucide-react" version="^0.552.0" />
          <dep name="recharts" version="^3.3.0" />
          <dep name="tailwindcss" version="^4.0.15" />
        </ui>
        <utils>
          <dep name="zod" version="^3.24.2" />
          <dep name="date-fns" version="^4.1.0" />
          <dep name="pino" version="^10.1.0" />
        </utils>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
- **Test Coverage Requirement**: 80% minimum coverage (lines, functions, branches, statements) - enforced by vitest.config.ts
- **E2E Test Browsers**: Chromium, Webkit (Safari), Mobile (iPhone 13) - per architecture.md and tech-spec-epic-1.md
- **Performance Targets**:
  - NFR001: Dashboard loading &lt;3s (P95)
  - NFR002: Alert delay &lt;5min
  - Lighthouse CI: LCP &lt;2.5s, FID &lt;100ms, CLS &lt;0.1
- **Security Validation**: TLS 1.3, AES-256 KMS encryption, bcrypt (10 rounds), NextAuth JWT
- **Monitoring Setup**: Vercel Analytics + Sentry required (currently not configured per Story 1.8 review)
- **Pilot Test Duration**: Minimum 1 week with 1 internal team
- **Epic 1 Validation Criteria**: At least 1 actual cost runaway prevention case documented
- **Test File Locations**:
  - E2E tests: __tests__/e2e/ (to be created)
  - Unit tests: src/lib/services/{module}/__tests__/ or co-located .test.ts
  - Integration tests: __tests__/integration/ (to be created)
- **Cron Job Testing**: Mock CRON_SECRET Bearer token authentication for manual triggers
- **Database Testing**: Use test database or in-memory database for E2E tests
- **CI/CD Integration**: All tests must pass in GitHub Actions before merge
- **Accessibility**: WCAG 2.1 AA compliance, Lighthouse Accessibility 95+ score
  </constraints>

  <interfaces>
    <interface>
      <name>tRPC appRouter</name>
      <kind>tRPC Root Router</kind>
      <signature>
export const appRouter = createTRPCRouter({
  auth: authRouter,      // Story 1.1: signup, login
  project: projectRouter, // Story 1.3: getAll, getById, create, updateMetrics
  team: teamRouter,      // Story 1.7: create, generateApiKey, listApiKeys
  cost: costRouter,      // Story 1.2, 1.5, 1.8: getRecentCosts, disableApiKey
  alert: alertRouter,    // Story 1.4: setThreshold, listAlerts
  report: reportRouter   // Story 1.6: getWeeklyReports, getLatest
});
      </signature>
      <path>src/server/api/root.ts</path>
    </interface>
    <interface>
      <name>Cron Jobs</name>
      <kind>Vercel Cron Endpoints</kind>
      <signature>
GET /api/cron/daily-batch      // Story 1.2: 매일 오전 9시 KST, OpenAI 비용 수집
GET /api/cron/poll-threshold   // Story 1.4: 5분마다, 비용 임계값 체크 및 알림
GET /api/cron/weekly-report    // Story 1.6: 월요일 오전 9시 KST, 주간 리포트 생성

Authorization: Bearer {CRON_SECRET}
Idempotency: cron_logs 테이블 (job_name, date unique)
      </signature>
      <path>src/app/api/cron/</path>
    </interface>
    <interface>
      <name>KMS Envelope Encryption</name>
      <kind>Service Interface</kind>
      <signature>
class KMSEnvelopeEncryption {
  async encrypt(plaintext: string): Promise&lt;{ciphertext, encryptedDataKey, iv}&gt;
  async decrypt(ciphertext: string, encryptedDataKey: string, iv: string): Promise&lt;string&gt;
}
      </signature>
      <path>src/lib/services/encryption/kms-envelope.ts</path>
    </interface>
    <interface>
      <name>Threshold Monitor</name>
      <kind>Service Interface</kind>
      <signature>
async function pollThresholds(): Promise&lt;void&gt;
// 모든 활성 프로젝트의 비용 임계값 체크
// 초과 시 Slack/Email 알림 발송
// Throttling: 1시간당 최대 1회
      </signature>
      <path>src/lib/services/monitoring/threshold-monitor.ts</path>
    </interface>
    <interface>
      <name>Efficiency Calculator</name>
      <kind>Service Interface</kind>
      <signature>
function calculateEfficiency(project: Project): number
// efficiency = successCount / totalCost
// Novel Pattern 1: 비용-가치 연결

function rankProjects(projects: Project[]): {top3, bottom3}
      </signature>
      <path>src/lib/services/reporting/efficiency.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
Vitest for unit and integration tests with happy-dom environment. MSW (Mock Service Worker) for external API mocking. Playwright for E2E tests across Chromium, Webkit, and Mobile. Test coverage target: 80% (lines, functions, branches, statements). Accessibility testing with jest-axe (WCAG 2.1 AA). Performance testing with Lighthouse CI. Test file naming: *.test.ts or *.spec.ts. E2E tests in __tests__/e2e/, unit tests co-located or in __tests__ subdirectories.
    </standards>
    <locations>
- E2E tests: __tests__/e2e/ (to be created in Story 1.9)
- Unit tests: src/lib/services/{module}/__tests__/ or co-located *.test.ts
- Integration tests: __tests__/integration/ (to be created in Story 1.9)
- Test config: vitest.config.ts (exists), playwright.config.ts (to be created)
- Coverage reports: coverage/ (gitignored)
    </locations>
    <ideas>
      <idea ac="1">
        <title>E2E User Journey: 비용 급증 감지 및 즉시 대응</title>
        <approach>Playwright test simulating full flow: signup → login → team create → project create → API key register → daily-batch cron trigger (mock OpenAI API) → threshold set → inject cost data over threshold → poll-threshold cron trigger → verify Slack/Email notification sent → API key disable → verify audit log. Mock external APIs (OpenAI, Slack, Resend). Test database cleanup before/after.</approach>
      </idea>
      <idea ac="1">
        <title>E2E User Journey: 주간 리포트 확인</title>
        <approach>Playwright test: login → navigate to reports page → verify weekly report displays Top 3/Bottom 3 projects → verify metrics (total cost, efficiency, week-over-week change) → verify report archive accessible. Mock weekly-report cron or trigger manually.</approach>
      </idea>
      <idea ac="1">
        <title>E2E User Journey: 프로젝트별 비용 드릴다운</title>
        <approach>Playwright test: login → projects page → select project → verify cost trend chart (30 days) → verify cost breakdown by task type → update project metrics → verify efficiency calculation → verify threshold setting UI.</approach>
      </idea>
      <idea ac="2">
        <title>Vercel Analytics Uptime Tracking</title>
        <approach>Configure Vercel project settings to enable Analytics. Query Vercel API for uptime data over 7 days. Assert 99.5% uptime (max 3.6 hours downtime). Document setup in monitoring docs.</approach>
      </idea>
      <idea ac="2">
        <title>Sentry Error Tracking Setup</title>
        <approach>Install @sentry/nextjs. Configure sentry.client.config.ts and sentry.server.config.ts. Set up error alerts to team Slack/Email. Verify error capture with intentional test error. Document in monitoring docs.</approach>
      </idea>
      <idea ac="3">
        <title>Pilot Test Checklist Validation</title>
        <approach>Create docs/pilot-test-checklist.md with 10-step checklist (signup, team, project, API key, cost, metrics, threshold, alert, disable, report). Pilot user completes checklist over 1 week. Collect feedback in docs/pilot-feedback.md.</approach>
      </idea>
      <idea ac="4">
        <title>TLS 1.3 Verification</title>
        <approach>Test production URL with SSL Labs (https://www.ssllabs.com/ssltest/). Assert A+ rating, TLS 1.3, security headers present. Document results in security-validation.md.</approach>
      </idea>
      <idea ac="4">
        <title>AES-256 KMS Encryption Test</title>
        <approach>Unit test for kms-envelope.ts: encrypt plaintext → verify ciphertext != plaintext → decrypt ciphertext → assert plaintext matches. Integration test: save API key to DB → read from DB → decrypt → verify matches original. Check encrypted_data_key, iv stored correctly.</approach>
      </idea>
      <idea ac="4">
        <title>bcrypt Password Hashing Verification</title>
        <approach>Unit test for auth service: hash password with bcrypt → verify hash starts with $2b$ (bcrypt identifier) → verify rounds = 10 (check hash format). Integration test: signup → verify password_hash in DB is bcrypt format.</approach>
      </idea>
      <idea ac="4">
        <title>NextAuth JWT Security Validation</title>
        <approach>Integration test: login → verify JWT cookie set with httpOnly, secure flags → verify session.user.id populated → verify JWT expiry = 30 days. Check JWT secret is not default.</approach>
      </idea>
      <idea ac="5">
        <title>비용 폭주 시뮬레이션</title>
        <approach>E2E test or manual scenario: 1) Create project with threshold $500, 2) Inject cost_data records totaling $742, 3) Trigger poll-threshold cron, 4) Verify alert sent within 5 min (NFR002), 5) Disable API key, 6) Document as "actual loss prevention case" in validation report.</approach>
      </idea>
      <idea ac="6">
        <title>Vitest Coverage Report</title>
        <approach>Run: bun run test:coverage. Check coverage/index.html for 80% threshold. Review uncovered lines. Write additional unit tests for: kms-envelope, api-key-manager, efficiency calculator, report-generator, audit-logger. Ensure all Novel Patterns have tests.</approach>
      </idea>
      <idea ac="6">
        <title>tRPC Integration Tests</title>
        <approach>Write integration tests for all routers (auth, project, team, cost, alert, report). Use MSW to mock Prisma queries or use test database. Test: input validation (Zod), error handling (TRPCError), authorization (protectedProcedure), response format. Target 100% procedure coverage.</approach>
      </idea>
      <idea ac="7">
        <title>Lighthouse CI Performance Test</title>
        <approach>Install @lhci/cli. Configure lighthouserc.json with thresholds: LCP &lt;2500, FID &lt;100, CLS &lt;0.1, Performance score &gt;90. Add to GitHub Actions CI pipeline. Test URLs: /, /dashboard, /projects/[id]. Assert all pass thresholds.</approach>
      </idea>
      <idea ac="7">
        <title>Dashboard Loading Time Measurement</title>
        <approach>E2E test with Playwright: measure page.goto('/dashboard') performance. Extract server timing headers. Assert P95 &lt; 3000ms. Use Playwright's built-in performance metrics or Vercel Analytics API.</approach>
      </idea>
      <idea ac="7">
        <title>Alert Delay Time Measurement</title>
        <approach>E2E test: inject cost data at timestamp T1 → trigger poll-threshold cron at T2 → verify alert received at T3 → assert (T3 - T1) &lt; 5 minutes. Mock Slack/Email to capture timestamp. Document in NFR002 validation report.</approach>
      </idea>
    </ideas>
  </tests>
</story-context>
