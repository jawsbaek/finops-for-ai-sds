# Story 1.17: ì„±ëŠ¥ ìµœì í™” - API ìºì‹± ì „ëµ

**Status:** ğŸ“‹ TODO

**Priority:** ğŸŸ¡ MEDIUM

---

## User Story

**As a** ì‹œìŠ¤í…œ ì‚¬ìš©ì,
**I want** API í˜¸ì¶œì´ ì ì ˆí•˜ê²Œ ìºì‹±ë˜ì–´,
**So that** ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì¤„ì´ê³  ë¹ ë¥¸ í˜ì´ì§€ ë¡œë”©ì„ ê²½í—˜í•  ìˆ˜ ìˆë‹¤.

---

## Context

**ë°°ê²½:**
í˜„ì¬ ëŒ€ë¶€ë¶„ì˜ tRPC ì¿¼ë¦¬ê°€ ê¸°ë³¸ ìºì‹± ì„¤ì •(staleTime: 0, gcTime: 5ë¶„)ì„ ì‚¬ìš©í•˜ê³  ìˆì–´, ë§¤ ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ë§ˆë‹¤ ë¶ˆí•„ìš”í•œ API ì¬í˜¸ì¶œì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë°ì´í„°(ì„¤ì •, ë¦¬í¬íŠ¸ ë“±)ì— ëŒ€í•´ ì ì ˆí•œ ìºì‹± ì „ëµì„ ì ìš©í•˜ë©´ ì„±ëŠ¥ ê°œì„ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**í˜„ì¬ ë¬¸ì œì :**
1. Dashboard í˜ì´ì§€ëŠ” 5ë¶„ ìºì‹± ì ìš© âœ… (ì–‘í˜¸)
2. Settings í˜ì´ì§€ëŠ” ìºì‹± ì—†ìŒ âš ï¸ (ê°œì„  í•„ìš”)
3. Reports í˜ì´ì§€ëŠ” ë¶ˆë³€ ë°ì´í„°ì¸ë° ìºì‹± ì—†ìŒ âš ï¸ (ê°œì„  í•„ìš”)
4. AIProviderRegistrationì€ ë¬´í•œ ë£¨í”„ ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ âœ… (PR #42)

**ì„±ëŠ¥ ì˜í–¥:**
- ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ìœ¼ë¡œ ì„œë²„ ë¶€í•˜ ì¦ê°€
- ì‚¬ìš©ìê°€ í˜ì´ì§€ ì „í™˜ ì‹œ ë°ì´í„° ê¹œë¹¡ì„ í˜„ìƒ
- ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ë°ì´í„° ë¹„ìš© ì¦ê°€

---

## TanStack Query (React Query) v5 ìºì‹± ê°œë…

### í•µì‹¬ ê°œë…

**1. staleTime (ì‹ ì„ ë„ ì‹œê°„)**
- ë°ì´í„°ê°€ "ì‹ ì„ í•œ" ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„
- ê¸°ë³¸ê°’: 0ms (ì¦‰ì‹œ stale ìƒíƒœë¡œ ì „í™˜)
- stale ìƒíƒœê°€ ë˜ë©´ ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ refetch ë°œìƒ
- ì˜ˆ: `staleTime: 5 * 60 * 1000` â†’ 5ë¶„ê°„ ì‹ ì„ í•œ ìƒíƒœ ìœ ì§€

**2. gcTime (Garbage Collection Time, êµ¬ cacheTime)**
- ë¹„í™œì„± ì¿¼ë¦¬ê°€ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ë˜ê¸°ê¹Œì§€ì˜ ì‹œê°„
- ê¸°ë³¸ê°’: 5ë¶„
- ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ì–´ ì¿¼ë¦¬ê°€ ë¹„í™œì„±í™”ëœ í›„ gcTimeë§Œí¼ ëŒ€ê¸°
- ì˜ˆ: `gcTime: 10 * 60 * 1000` â†’ 10ë¶„ê°„ ë©”ëª¨ë¦¬ì— ë³´ê´€

**3. ì¤‘ìš” ê·œì¹™**
```
staleTime â‰¤ gcTime (í•­ìƒ!)
```

### ìºì‹± ë™ì‘ íë¦„

```
1. Initial Fetch â†’ Data is Fresh (staleTime ë‚´)
2. After staleTime â†’ Data becomes Stale
3. Component remount â†’ Background refetch (show stale data instantly)
4. Component unmount â†’ Query becomes Inactive
5. After gcTime â†’ Data removed from memory
```

---

## Next.js 15 + tRPC ìºì‹± ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ë°ì´í„° ìœ í˜•ë³„ ìºì‹± ì „ëµ

| ë°ì´í„° ìœ í˜• | staleTime | gcTime | ì‚¬ìš© ì˜ˆì‹œ |
|------------|-----------|--------|-----------|
| **ì‹¤ì‹œê°„ ë°ì´í„°** | 0ms | 30s | ì£¼ì‹ ê°€ê²©, ì‹¤ì‹œê°„ ì•Œë¦¼ |
| **ì¤€ì‹¤ì‹œê°„ ë°ì´í„°** | 1-5ë¶„ | 10ë¶„ | ëŒ€ì‹œë³´ë“œ í†µê³„, ë¹„ìš© ë°ì´í„° |
| **ì •ì  ë°ì´í„°** | 30ë¶„-1ì‹œê°„ | 2ì‹œê°„ | ì‚¬ìš©ì í”„ë¡œí•„, ì„¤ì • |
| **ë¶ˆë³€ ë°ì´í„°** | Infinity | Infinity | ê³¼ê±° ë¦¬í¬íŠ¸, ì•„ì¹´ì´ë¸Œ |

### 2. ê¶Œì¥ ê¸°ë³¸ ì„¤ì •

**ê¸€ë¡œë²Œ ì„¤ì • (trpc/react.tsx):**
```typescript
import { createTRPCReact } from '@trpc/react-query';
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 60 * 1000, // 1ë¶„ (ê¸°ë³¸)
      gcTime: 5 * 60 * 1000, // 5ë¶„ (ê¸°ë³¸)
      refetchOnWindowFocus: false, // ì°½ í¬ì»¤ìŠ¤ ì‹œ ì¬ì¡°íšŒ ë¹„í™œì„±í™”
      refetchOnReconnect: true, // ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ì‹œ ì¬ì¡°íšŒ
      retry: 3, // ì‹¤íŒ¨ ì‹œ 3íšŒ ì¬ì‹œë„
    },
  },
});
```

### 3. í˜ì´ì§€ë³„ ìµœì í™” ì „ëµ

#### Dashboard (âœ… ì´ë¯¸ ìµœì í™”ë¨)
```typescript
// ë¹„ìš© ì§‘ê³„ ë°ì´í„° - 8-24ì‹œê°„ ì§€ì—°ë˜ë¯€ë¡œ 5ë¶„ ìºì‹œ ì ì ˆ
const { data: costSummary } = api.cost.getSummary.useQuery(
  {},
  {
    staleTime: 5 * 60 * 1000, // 5ë¶„
    gcTime: 10 * 60 * 1000, // 10ë¶„
  }
);
```

#### Reports Page (âš ï¸ ê°œì„  í•„ìš”)
```typescript
// ê³¼ê±° ë¦¬í¬íŠ¸ëŠ” ë¶ˆë³€ ë°ì´í„° â†’ ë¬´í•œ ìºì‹±
const { data: reports } = api.report.getRecentReports.useQuery(
  { limit: 12 },
  {
    staleTime: Infinity, // ì ˆëŒ€ stale ìƒíƒœë¡œ ì „í™˜í•˜ì§€ ì•ŠìŒ
    gcTime: 60 * 60 * 1000, // 1ì‹œê°„ ë©”ëª¨ë¦¬ ë³´ê´€
  }
);

// ê°œë³„ ë¦¬í¬íŠ¸ ìƒì„¸ë„ ë¶ˆë³€ ë°ì´í„°
const { data: selectedReport } = api.report.getReportById.useQuery(
  { id: selectedReportId ?? "" },
  {
    enabled: !!selectedReportId,
    staleTime: Infinity, // ë¶ˆë³€ ë°ì´í„°
    gcTime: 30 * 60 * 1000, // 30ë¶„
  }
);
```

#### Settings Page (âš ï¸ ê°œì„  í•„ìš”)
```typescript
// í”„ë¡œì íŠ¸ ì„¤ì • - ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ
const { data: project } = api.project.getById.useQuery(
  { id: projectId },
  {
    staleTime: 5 * 60 * 1000, // 5ë¶„
    gcTime: 10 * 60 * 1000, // 10ë¶„
  }
);

// ì•Œë¦¼ ì„¤ì • - ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ
const { data: alerts } = api.alert.getAlerts.useQuery(
  { projectId },
  {
    staleTime: 5 * 60 * 1000, // 5ë¶„
    gcTime: 10 * 60 * 1000, // 10ë¶„
  }
);
```

### 4. ê³ ê¸‰ íŒ¨í„´

#### Prefetching (ì‚¬ìš©ì ê²½í—˜ ê°œì„ )
```typescript
// ì‚¬ìš©ìê°€ í”„ë¡œì íŠ¸ ì¹´ë“œì— hoverí•˜ë©´ ë¯¸ë¦¬ ë°ì´í„° ë¡œë“œ
const utils = api.useUtils();

<Card
  onMouseEnter={() => {
    void utils.project.getById.prefetch({ id: projectId });
  }}
>
```

#### Optimistic Updates (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)
```typescript
const updateProject = api.project.update.useMutation({
  onMutate: async (newData) => {
    // ì´ì „ ë°ì´í„° ì·¨ì†Œ
    await utils.project.getById.cancel({ id: projectId });

    // ìŠ¤ëƒ…ìƒ· ì €ì¥
    const previousData = utils.project.getById.getData({ id: projectId });

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    utils.project.getById.setData({ id: projectId }, (old) => ({
      ...old,
      ...newData,
    }));

    return { previousData };
  },
  onError: (err, newData, context) => {
    // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡¤ë°±
    if (context?.previousData) {
      utils.project.getById.setData({ id: projectId }, context.previousData);
    }
  },
  onSettled: () => {
    // ì„œë²„ ë°ì´í„°ë¡œ ë™ê¸°í™”
    void utils.project.getById.invalidate({ id: projectId });
  },
});
```

#### Selective Invalidation (ì„ íƒì  ë¬´íš¨í™”)
```typescript
// íŠ¹ì • í”„ë¡œì íŠ¸ë§Œ ë¬´íš¨í™”
utils.project.getById.invalidate({ id: projectId });

// ëª¨ë“  í”„ë¡œì íŠ¸ ëª©ë¡ ë¬´íš¨í™”
utils.project.getAll.invalidate();

// íŠ¹ì • íŒ€ì˜ ëª¨ë“  ì¿¼ë¦¬ ë¬´íš¨í™”
utils.team.invalidate();
```

---

## Acceptance Criteria

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

#### 1. ê¸€ë¡œë²Œ ìºì‹± ì„¤ì • ê°œì„ 
- [ ] `trpc/react.tsx`ì— í•©ë¦¬ì ì¸ ê¸°ë³¸ staleTime (1ë¶„) ì„¤ì •
- [ ] refetchOnWindowFocusë¥¼ falseë¡œ ì„¤ì • (ì˜ë„ì  refetchë§Œ í—ˆìš©)
- [ ] retry ì •ì±… ì„¤ì • (3íšŒ)

#### 2. Reports í˜ì´ì§€ ìµœì í™”
- [ ] `getRecentReports` ì¿¼ë¦¬ì— Infinity staleTime ì ìš©
- [ ] `getReportById` ì¿¼ë¦¬ì— Infinity staleTime ì ìš©
- [ ] gcTimeì„ 30-60ë¶„ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± í™•ë³´

#### 3. Settings í˜ì´ì§€ ìµœì í™”
- [ ] Project settings ì¿¼ë¦¬ì— 5ë¶„ staleTime ì ìš©
- [ ] Alerts ì¿¼ë¦¬ì— 5ë¶„ staleTime ì ìš©
- [ ] Admin keys ì¿¼ë¦¬ì— 5ë¶„ staleTime ì ìš©

#### 4. ë¬¸ì„œí™”
- [ ] ê° í˜ì´ì§€ë³„ ìºì‹± ì „ëµ ë¬¸ì„œí™”
- [ ] ìƒˆë¡œìš´ í˜ì´ì§€ ì¶”ê°€ ì‹œ ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ìºì‹± ê°€ì´ë“œ ì‘ì„±
- [ ] ìºì‹± ì„¤ì • ê²°ì • íŠ¸ë¦¬(decision tree) ì‘ì„±

#### 5. ì„±ëŠ¥ ì¸¡ì •
- [ ] Chrome DevTools Network íƒ­ìœ¼ë¡œ API í˜¸ì¶œ íšŸìˆ˜ ì¸¡ì •
- [ ] React Query DevToolsë¡œ ìºì‹œ íˆíŠ¸ìœ¨ í™•ì¸
- [ ] ìµœì í™” ì „í›„ ë¹„êµ ë¦¬í¬íŠ¸ ì‘ì„±

---

## Technical Implementation

### Phase 1: ê¸€ë¡œë²Œ ì„¤ì • ê°œì„ 

**src/trpc/react.tsx ìˆ˜ì •:**
```typescript
import { createTRPCReact } from '@trpc/react-query';
import { QueryClient } from '@tanstack/react-query';
import type { AppRouter } from '~/server/api/root';

export const api = createTRPCReact<AppRouter>();

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // ê¸°ë³¸ 1ë¶„ ì‹ ì„ ë„ ìœ ì§€ (ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ì— ì ì ˆ)
      staleTime: 60 * 1000,

      // 5ë¶„ê°„ ë©”ëª¨ë¦¬ì— ë³´ê´€ (ê¸°ë³¸ê°’)
      gcTime: 5 * 60 * 1000,

      // ì°½ í¬ì»¤ìŠ¤ ì‹œ ìë™ refetch ë¹„í™œì„±í™”
      // (ëª…ì‹œì  invalidationë§Œ í—ˆìš©)
      refetchOnWindowFocus: false,

      // ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²° ì‹œ refetch í™œì„±í™”
      refetchOnReconnect: true,

      // ì‹¤íŒ¨ ì‹œ 3íšŒ ì¬ì‹œë„ (exponential backoff)
      retry: 3,
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
    },
  },
});
```

### Phase 2: Reports í˜ì´ì§€ ìµœì í™”

**src/app/(dashboard)/reports/page.tsx ìˆ˜ì •:**
```typescript
"use client";

import { format } from "date-fns";
import { FileText, TrendingDown, TrendingUp } from "lucide-react";
import { useState } from "react";
import { api } from "~/trpc/react";

export default function ReportsPage() {
  const [selectedReportId, setSelectedReportId] = useState<string | null>(null);

  // âœ… ê³¼ê±° ë¦¬í¬íŠ¸ëŠ” ë¶ˆë³€ ë°ì´í„° â†’ ë¬´í•œ ìºì‹±
  const { data: reports, isLoading } = api.report.getRecentReports.useQuery(
    { limit: 12 },
    {
      staleTime: Infinity, // ì ˆëŒ€ stale ìƒíƒœë¡œ ì „í™˜í•˜ì§€ ì•ŠìŒ
      gcTime: 60 * 60 * 1000, // 1ì‹œê°„ ë©”ëª¨ë¦¬ ë³´ê´€
    }
  );

  // âœ… ê°œë³„ ë¦¬í¬íŠ¸ ìƒì„¸ë„ ë¶ˆë³€ ë°ì´í„°
  const { data: selectedReport } = api.report.getReportById.useQuery(
    { id: selectedReportId ?? "" },
    {
      enabled: !!selectedReportId,
      staleTime: Infinity, // ë¶ˆë³€ ë°ì´í„°
      gcTime: 30 * 60 * 1000, // 30ë¶„ ë©”ëª¨ë¦¬ ë³´ê´€
    }
  );

  // ... rest of component
}
```

### Phase 3: Settings í˜ì´ì§€ ìµœì í™”

**src/app/(dashboard)/projects/[id]/settings/page.tsx ìˆ˜ì •:**
```typescript
"use client";

import { useParams } from "next/navigation";
import { useState } from "react";
import { toast } from "sonner";
import { api } from "~/trpc/react";

export default function ProjectSettingsPage() {
  const params = useParams();
  const projectId = params.id as string;

  const [thresholdType, setThresholdType] = useState<"daily" | "weekly">("daily");
  const [thresholdValue, setThresholdValue] = useState<string>("");

  // âœ… í”„ë¡œì íŠ¸ ì„¤ì •ì€ ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ â†’ 5ë¶„ ìºì‹±
  const { data: project, refetch: refetchProject } =
    api.project.getById.useQuery(
      { id: projectId },
      {
        staleTime: 5 * 60 * 1000, // 5ë¶„
        gcTime: 10 * 60 * 1000, // 10ë¶„
      }
    );

  // âœ… Admin keysëŠ” ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ â†’ 5ë¶„ ìºì‹±
  const { data: adminKeys } = api.team.getAdminApiKeys.useQuery(
    { teamId: project?.teamId ?? "" },
    {
      enabled: !!project?.teamId,
      staleTime: 5 * 60 * 1000, // 5ë¶„
      gcTime: 10 * 60 * 1000, // 10ë¶„
    }
  );

  // âœ… ì•Œë¦¼ ì„¤ì •ë„ ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ â†’ 5ë¶„ ìºì‹±
  const { data: alerts, refetch: refetchAlerts } = api.alert.getAlerts.useQuery(
    { projectId },
    {
      staleTime: 5 * 60 * 1000, // 5ë¶„
      gcTime: 10 * 60 * 1000, // 10ë¶„
    }
  );

  // ... mutations and handlers
}
```

### Phase 4: ìºì‹± ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

**docs/development/CACHING_GUIDE.md (NEW FILE):**
```markdown
# tRPC + TanStack Query ìºì‹± ê°€ì´ë“œ

## ìºì‹± ì „ëµ ê²°ì • íŠ¸ë¦¬

1. **ì´ ë°ì´í„°ëŠ” í•œ ë²ˆ ìƒì„±ë˜ë©´ ì ˆëŒ€ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ê°€?** (ì˜ˆ: ê³¼ê±° ë¦¬í¬íŠ¸)
   â†’ YES: `staleTime: Infinity`, `gcTime: 30-60ë¶„`

2. **ì´ ë°ì´í„°ëŠ” ë§¤ìš° ìì£¼ ë³€ê²½ë˜ëŠ”ê°€?** (ì˜ˆ: ì‹¤ì‹œê°„ ê°€ê²©)
   â†’ YES: `staleTime: 0`, `gcTime: 30ì´ˆ`

3. **ì´ ë°ì´í„°ëŠ” ê°€ë” ë³€ê²½ë˜ëŠ”ê°€?** (ì˜ˆ: ì„¤ì •, í”„ë¡œí•„)
   â†’ YES: `staleTime: 5-10ë¶„`, `gcTime: 10-20ë¶„`

4. **ì´ ë°ì´í„°ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ”ê°€?** (ì˜ˆ: ë¹„ìš© ì§‘ê³„)
   â†’ YES: `staleTime: ì—…ë°ì´íŠ¸ ì£¼ê¸°`, `gcTime: 2x staleTime`

## ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆ í˜ì´ì§€ë‚˜ ì¿¼ë¦¬ë¥¼ ì¶”ê°€í•  ë•Œ:
- [ ] ë°ì´í„° ë³€ê²½ ë¹ˆë„ë¥¼ íŒŒì•…í–ˆëŠ”ê°€?
- [ ] ì ì ˆí•œ staleTimeì„ ì„¤ì •í–ˆëŠ”ê°€?
- [ ] gcTimeì´ staleTimeë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ê°€?
- [ ] refetchOnWindowFocus ì„¤ì •ì´ ì ì ˆí•œê°€?
- [ ] enabled ì¡°ê±´ì„ ì‚¬ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ í˜¸ì¶œì„ ë°©ì§€í–ˆëŠ”ê°€?

## ì˜ˆì œ ì½”ë“œ

[... ì‹¤ì œ ì˜ˆì œ ì½”ë“œë“¤ ...]
```

---

## Testing Plan

### 1. ìˆ˜ë™ í…ŒìŠ¤íŠ¸

#### Reports í˜ì´ì§€
1. ë¦¬í¬íŠ¸ ëª©ë¡ í˜ì´ì§€ ë¡œë“œ
2. Chrome DevTools Network íƒ­ í™•ì¸ â†’ API í˜¸ì¶œ 1íšŒ
3. ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ í›„ ë‹¤ì‹œ ëŒì•„ì˜¤ê¸°
4. Network íƒ­ í™•ì¸ â†’ API í˜¸ì¶œ 0íšŒ (ìºì‹œì—ì„œ ë¡œë“œ) âœ…

#### Settings í˜ì´ì§€
1. Settings í˜ì´ì§€ ë¡œë“œ
2. Network íƒ­ í™•ì¸ â†’ API í˜¸ì¶œ ë°œìƒ
3. 5ë¶„ ì´ë‚´ì— í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
4. Network íƒ­ í™•ì¸ â†’ API í˜¸ì¶œ 0íšŒ (ìºì‹œì—ì„œ ë¡œë“œ) âœ…
5. 5ë¶„ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
6. Network íƒ­ í™•ì¸ â†’ ë°±ê·¸ë¼ìš´ë“œ refetch ë°œìƒ âœ…

### 2. React Query DevTools í™•ì¸

```typescript
// src/app/layout.tsxì— ì¶”ê°€
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <ReactQueryDevtools initialIsOpen={false} />
      </body>
    </html>
  );
}
```

**í™•ì¸ ì‚¬í•­:**
- [ ] ê° ì¿¼ë¦¬ì˜ staleTime/gcTimeì´ ì˜ë„ëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
- [ ] ìºì‹œ íˆíŠ¸ê°€ ë°œìƒí•˜ëŠ”ê°€?
- [ ] ë¶ˆí•„ìš”í•œ refetchê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ê°€?

### 3. ì„±ëŠ¥ ì¸¡ì •

**Before/After ë¹„êµ:**

| í˜ì´ì§€ | ìµœì í™” ì „ API í˜¸ì¶œ íšŸìˆ˜ | ìµœì í™” í›„ API í˜¸ì¶œ íšŸìˆ˜ | ê°œì„ ìœ¨ |
|--------|------------------------|------------------------|--------|
| Reports (ì¬ë°©ë¬¸) | 2íšŒ | 0íšŒ | 100% â†“ |
| Settings (5ë¶„ ë‚´ ì¬ë°©ë¬¸) | 3íšŒ | 0íšŒ | 100% â†“ |
| Settings (5ë¶„ í›„ ì¬ë°©ë¬¸) | 3íšŒ | 3íšŒ (ë°±ê·¸ë¼ìš´ë“œ) | - |

---

## Performance Metrics

### ëª©í‘œ ì„±ëŠ¥ ì§€í‘œ

1. **ìºì‹œ íˆíŠ¸ìœ¨**: 70% ì´ìƒ
2. **í‰ê·  API í˜¸ì¶œ ê°ì†Œ**: 40% ì´ìƒ
3. **í˜ì´ì§€ ë¡œë”© ì‹œê°„**: 20% ê°œì„ 

### ì¸¡ì • ë°©ë²•

```typescript
// ìºì‹œ íˆíŠ¸ìœ¨ ì¶”ì  (ê°œë°œ í™˜ê²½)
if (process.env.NODE_ENV === 'development') {
  queryClient.getQueryCache().subscribe((event) => {
    if (event.type === 'observerResultsUpdated') {
      const query = event.query;
      if (query.state.dataUpdateCount > 0 && !query.state.isFetching) {
        console.log('Cache hit:', query.queryKey);
      }
    }
  });
}
```

---

## Rollout Plan

### Phase 1: Low-Risk Changes (Week 1)
- [ ] ê¸€ë¡œë²Œ ê¸°ë³¸ ì„¤ì • ì—…ë°ì´íŠ¸
- [ ] Reports í˜ì´ì§€ ìµœì í™”
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘

### Phase 2: Medium-Risk Changes (Week 2)
- [ ] Settings í˜ì´ì§€ ìµœì í™”
- [ ] ë‹¤ë¥¸ ì„¤ì • í˜ì´ì§€ë“¤ ìµœì í™”
- [ ] ìºì‹± ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

### Phase 3: Validation & Documentation (Week 3)
- [ ] ì„±ëŠ¥ ì§€í‘œ ìˆ˜ì§‘ ë° ë¶„ì„
- [ ] íŒ€ê³¼ ê²°ê³¼ ê³µìœ 
- [ ] ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ë¬¸ì„œí™”

---

## Related Issues

- âœ… PR #42: AIProviderRegistration ë¬´í•œ ë£¨í”„ ìˆ˜ì •
- Story 1.12: ì¿¼ë¦¬ ìµœì í™” ë° ì¸ë±ìŠ¤ ì¶”ê°€
- Story 1.16: react-hook-form ì„±ëŠ¥ ìµœì í™”

---

## References

- [TanStack Query v5 Docs - Caching](https://tanstack.com/query/v5/docs/react/guides/caching)
- [Next.js 15 Caching Guide](https://nextjs.org/docs/app/guides/caching)
- [tRPC React Query Integration](https://trpc.io/docs/client/react/useQuery)
- [Mastering staleTime and gcTime](https://asrulkadir.medium.com/mastering-staletime-and-gctime-in-react-query-the-secrets-to-smarter-data-caching-22499ce3010f)

---

## Definition of Done

- [ ] ëª¨ë“  acceptance criteria ì™„ë£Œ
- [ ] ìºì‹œ íˆíŠ¸ìœ¨ 70% ì´ìƒ ë‹¬ì„±
- [ ] API í˜¸ì¶œ íšŸìˆ˜ 40% ì´ìƒ ê°ì†Œ
- [ ] React Query DevToolsë¡œ ìºì‹± ë™ì‘ ê²€ì¦
- [ ] ìºì‹± ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„± ì™„ë£Œ
- [ ] íŒ€ ë¦¬ë·° ë° ìŠ¹ì¸
- [ ] Production ë°°í¬ ì™„ë£Œ
